apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: aws-sqs-queue-scaledobject
  namespace: keda-test
  annotations:
    autoscaling.keda.sh/paused: "false"
spec:
  scaleTargetRef:
    name: sqs-app
  minReplicaCount: 1
  maxReplicaCount: 2000
  
  # ‚ö° POLLING ACELERADO - Verifica a cada 5 segundos (padr√£o: 30s)
  pollingInterval: 5
  
  # ‚ö° COOLDOWN ACELERADO - Aguarda 5s antes de scale-down (padr√£o: 10s)
  cooldownPeriod: 5
  
  # üé• COMPORTAMENTO OTIMIZADO PARA V√çDEO
  advanced:
    horizontalPodAutoscalerConfig:
      behavior:
        scaleDown:
          # ‚ö° ESTABILIZA√á√ÉO R√ÅPIDA - Decis√£o em 15s (padr√£o: 300s = 5 minutos!)
          stabilizationWindowSeconds: 15
          
          # ‚ö° POL√çTICAS AGRESSIVAS DE SCALE-DOWN
          policies:
          # Permite remover 100% dos pods a cada 15 segundos
          - type: Percent
            value: 100
            periodSeconds: 15
          
          # OU remove 50 pods de uma vez (o que for maior)
          - type: Pods
            value: 50
            periodSeconds: 15
          
          # Max = mais agressivo (remove o m√°ximo poss√≠vel)
          selectPolicy: Max
        
        scaleUp:
          # Scale-up tamb√©m r√°pido para o v√≠deo ficar din√¢mico
          stabilizationWindowSeconds: 0
          policies:
          # Permite adicionar 100% dos pods a cada 10 segundos
          - type: Percent
            value: 100
            periodSeconds: 10
          
          # OU adiciona 50 pods de uma vez
          - type: Pods
            value: 50
            periodSeconds: 10
          
          selectPolicy: Max
  
  triggers:
  - type: aws-sqs-queue
    authenticationRef:
      name: keda-aws-credentials
    metadata:
      queueURL: https://sqs.us-east-1.amazonaws.com/794038226274/keda-demo-queue.fifo
      queueLength: "2"
      awsRegion: us-east-1
      identityOwner: operator
